<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="js/app.js"></script>
</head>
<body>


<script>
    // Polyfill
    if (! Promise.myAllSettled) {
        const rejectHandler = function (reason) {
            return {
                "status": "rejected",
                "reason": reason
            }
        };

        const resolveHandler = function (value) {
            return {
                "status": "fulfilled",
                "value": value
            }
        };

        // take all promised, e passagli gli handler
        Promise.myAllSettled = function (promises) {
            // convert all 'promises' passed as argument to real promises objects
            const convertedPromises = promises.map(p => {
                return Promise.resolve(p)
                // .then(
                //     fulfilled => {
                //         console.log('fulfilled', fulfilled);
                //         return fulfilled;
                //     },
                //     rejected => {
                //         console.error('rejected', rejected);
                //         throw rejected
                //     }
                // )
                .then(resolveHandler, rejectHandler);
            });

            console.log(convertedPromises);

            return Promise.all(convertedPromises)
        }
    }


    let globalPromise = Promise.myAllSettled([
        new Promise(resolve => setTimeout(() => resolve(1), 1000)),
        new Promise(resolve => setTimeout(() => resolve(2), 500)),
        new Promise((resolve, reject) => reject(new Error("Whoops!"))),
        new Promise(resolve => setTimeout(() => resolve(3), 800)),
        "ehi"
    ])
    .catch(err => {
        console.log(err);
    })
    .then(result => console.log('result', result));
</script>

</body>
</html>
